<!DOCTYPE html>
<html>
<head>
    <title>Manage Bookings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>Manage Bookings</h1>
<a href="/">‚Üê Back to Dashboard</a>

<hr>

<h2>Create Booking</h2>

<form method="POST">
    <input type="text" name="passenger_name" placeholder="Passenger Name" required>

    <!-- FLIGHT SELECTION -->
    <select name="flight_id" onchange="location='?flight_id=' + this.value" required>
        <option value="">Select Flight</option>
        {% for f in flights %}
            <option value="{{ f.id }}"
            {% if request.args.get('flight_id') == f.id|string %}selected{% endif %}>
                {{ f.flight_no }}
            </option>
        {% endfor %}
    </select>

    <!-- SEAT SELECTION -->
    {% if seats %}
        <h3>Select Seat</h3>

        <!-- LEGEND -->
        <div class="legend">
            <div><span class="seat available"></span> Available</div>
            <div><span class="seat booked"></span> Booked</div>
            <div><span class="seat selected"></span> Selected</div>
        </div>

        <!-- SEAT GRID -->
        <div class="seat-container">
            {% for s in seats %}
                {% if s.is_booked %}
                    <div class="seat booked">{{ s.seat_number }}</div>
                {% else %}
                    <label class="seat available">
                        <input type="radio" name="seat_id" value="{{ s.id }}" hidden>
                        <span>{{ s.seat_number }}</span>
                    </label>
                {% endif %}
            {% endfor %}
        </div>
    {% elif request.args.get('flight_id') %}
        <p class="no-seats">No seats available</p>
    {% endif %}

    <button type="submit" id="bookBtn" disabled>Book Flight</button>
</form>

<hr>

<h2>Booking List</h2>

{% if bookings %}
<table>
    <tr>
        <th>Booking ID</th>
        <th>Passenger</th>
        <th>Flight</th>
        <th>Seat</th>
        <th>Status</th>
        <th>Action</th>
    </tr>

    {% for b in bookings %}
    <tr>
        <td>{{ b.booking_code }}</td>
        <td>{{ b.passenger_name }}</td>
        <td>{{ b.flight_no }}</td>
        <td>{{ b.seat_number }}</td>
        <td>{{ b.booking_status }}</td>
        <td>
            <a class="cancel-btn"
               href="/delete_booking/{{ b.id }}"
               onclick="return confirm('Cancel booking?')">
               Cancel
            </a>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No bookings yet.</p>
{% endif %}

<script src="{{ url_for('static', filename='bookings.js') }}"></script>
</body>
</html>
